# Requirements Archive: v1.2 Ergonomic CLI Output

**Archived:** 2026-02-12
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.2.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone via `/gsd-new-milestone`).

---

## v1.2 Requirements

**Defined:** 2026-02-06
**Core Value:** Ergonomic CLI output for easier navigation by both humans and LLMs

### Output Formatting

- [x] **OUTP-01**: Tool listing shows parameter overview (names, types, required/optional status) in help-style format
- [x] **OUTP-02**: Progressive detail levels via flags: default (summary) → `-d` (with descriptions) → `-v` (verbose with full schema)
- [x] **OUTP-03**: Default `list` command shows tool count and brief descriptions per server
- [x] **OUTP-04**: Multi-server listings have clear visual hierarchy (server headers, grouped tools)
- [x] **OUTP-05**: Consistent formatting across all commands (list, info, grep, call)
- [x] **OUTP-06**: Parameter display uses standard CLI conventions (e.g., `name <type>` for required, `name [type]` for optional)

### Output Modes

- [x] **OUTP-07**: JSON output mode (`--json` flag) for programmatic use and scripting
- [x] **OUTP-08**: JSON output includes complete tool metadata (name, description, parameters, schema)
- [x] **OUTP-09**: Plain text mode (`--no-color` or when piped) works correctly for all commands
- [x] **OUTP-10**: Machine-readable output follows consistent schema across all commands

### Tool Discovery UX

- [x] **OUTP-11**: Tool descriptions are prominently displayed (not truncated in default view)
- [x] **OUTP-12**: Usage hints shown in tool listings (e.g., "Use `mcp info server tool` for full schema")
- [x] **OUTP-13**: Server status clearly indicated (connected, failed, disabled tools present)
- [x] **OUTP-14**: Tool search (grep) results show context (server name + tool description)
- [x] **OUTP-15**: Empty states have helpful messages (no servers configured, no tools found)

### Error & Warning Display

- [x] **OUTP-16**: Error messages maintain consistent format with context and suggestions
- [x] **OUTP-17**: Warnings are visually distinct but not overwhelming
- [x] **OUTP-18**: Partial failures (some servers down) show which succeeded and which failed

---

## Traceability (v1.2)

| Requirement | Phase | Status |
|-------------|-------|--------|
| OUTP-01 | Phase 6 | Complete |
| OUTP-02 | Phase 6 | Complete |
| OUTP-03 | Phase 6 | Complete |
| OUTP-04 | Phase 6 | Complete |
| OUTP-05 | Phase 6 | Complete |
| OUTP-06 | Phase 6 | Complete |
| OUTP-07 | Phase 7 | Complete |
| OUTP-08 | Phase 7 | Complete |
| OUTP-09 | Phase 7 | Complete |
| OUTP-10 | Phase 7 | Complete |
| OUTP-11 | Phase 6 | Complete |
| OUTP-12 | Phase 6 | Complete |
| OUTP-13 | Phase 6 | Complete |
| OUTP-14 | Phase 6 | Complete |
| OUTP-15 | Phase 6 | Complete |
| OUTP-16 | Phase 6 | Complete |
| OUTP-17 | Phase 6 | Complete |
| OUTP-18 | Phase 6 | Complete |

**Coverage:**
- v1.2 requirements: 18 total
- Mapped to phases: 18 ✅
- Satisfied: 18/18 ✅
- Unmapped: 0

**Phase Distribution:**
- Phase 6: 14 requirements (Output Formatting, Tool Discovery UX, Error Display)
- Phase 7: 4 requirements (Output Modes)

---

## v1 Requirements (Carried Forward)

All v1 requirements remain satisfied from v1.0:

### Configuration

- [x] **CONFIG-01**: Parse server configuration from mcp_servers.toml file with support for both stdio (command, args, env, cwd) and HTTP (url, headers) server definitions
- [x] **CONFIG-02**: Search for configuration files in priority order: explicit path (MCP_CONFIG_PATH), command line (-c/--config), current directory mcp_servers.toml, home directory .mcp_servers.toml, ~/.config/mcp/mcp_servers.toml
- [x] **CONFIG-03**: Support environment variable overrides for layered configuration (env vars take precedence over config file values)
- [x] **CONFIG-04**: Validate TOML structure and display clear errors for missing fields, invalid TOML, or server misconfiguration
- [x] **CONFIG-05**: Display warning message when no servers are configured

### Server Connections

- [x] **CONN-01**: Connect to MCP servers via stdio transport (local process spawning)
- [x] **CONN-02**: Connect to MCP servers via HTTP transport (remote API)
- [x] **CONN-03**: Handle connection lifecycle (connect, disconnect, timeouts)
- [x] **CONN-04**: Use tokio::process for async process spawning with kill_on_drop(true) to prevent zombie processes on Windows
- [x] **CONN-05**: Implement connection daemon using Unix sockets (*nix) and Windows named pipes for cross-platform IPC
- [x] **CONN-06**: Spawn daemon lazily on first access with idle timeout (60s default)
- [x] **CONN-07**: Detect configuration changes and spawn new daemon when cached config becomes stale
- [x] **CONN-08**: Cleanup orphaned daemon processes and sockets on startup

### Discovery & Search

- [x] **DISC-01**: List all configured servers with their available tools when no subcommand is provided
- [x] **DISC-02**: Display server details including transport type, connection information, tool count, and server instructions
- [x] **DISC-03**: Display tool details (name, description, input JSON Schema) for inspection
- [x] **DISC-04**: Search tool names (not server names) using glob patterns with wildcards (*, ?, etc.)
- [x] **DISC-05**: Process servers in parallel with configurable concurrency limits (default 5)
- [x] **DISC-06**: Support optional display of descriptions via -d/--with-descriptions flag

### Tool Execution

- [x] **EXEC-01**: Execute tools with JSON arguments provided either inline or via stdin pipe
- [x] **EXEC-02**: Automatically detect stdin input when TTY is not present (pipe redirection)
- [x] **EXEC-03**: Format tool call results to extract text content for CLI-friendly display
- [x] **EXEC-04**: Validate JSON tool arguments and display parse errors with context
- [x] **EXEC-05**: Implement automatic retry logic with exponential backoff for transient errors (network timeouts, HTTP 502/503/504/429)
- [x] **EXEC-06**: Respect overall operation timeout (default 1800s) and stop retries if budget exhausted
- [x] **EXEC-07**: Configure retry limits (max 3 attempts, base 1000ms delay)

### Tool Filtering

- [x] **FILT-01**: Filter tool availability based on server configuration using allowedTools glob patterns
- [x] **FILT-02**: Filter tool availability based on server configuration using disabledTools glob patterns
- [x] **FILT-03**: Ensure disabledTools patterns take precedence over allowedTools patterns when both are defined
- [x] **FILT-04**: Display error message when user attempts to call disabled tool
- [x] **FILT-05**: Support glob pattern wildcards (*, ?) in filter rules

### Error Handling

- [x] **ERR-01**: Provide structured error messages with error type, message, details, and actionable recovery suggestions
- [x] **ERR-02**: Display context-aware error suggestions (e.g., list available servers when server not found)
- [x] **ERR-03**: Implement exit code conventions: 0 for success, 1 for client errors, 2 for server errors, 3 for network errors
- [x] **ERR-04**: Display colored terminal output when stdout is a TTY and NO_COLOR is not set
- [x] **ERR-05**: Capture and forward stderr output from stdio-based MCP servers to the user
- [x] **ERR-06**: Handle ambiguous commands (e.g., "server tool" without subcommand) and prompt user to specify info vs call
- [x] **ERR-07**: Warn when some servers fail to connect during parallel operations

### CLI Support

- [x] **CLI-01**: Display help information when -h/--help flag is provided
- [x] **CLI-02**: Display version information when -v/--version flag is provided
- [x] **CLI-03**: Support custom config file path via -c/--config command line option
- [x] **CLI-04**: Gracefully handle signals (SIGINT, SIGTERM) with proper cleanup of connections and resources
- [x] **CLI-05**: Support both space-separated (server tool) and slash-separated (server/tool) argument formats for info, grep, and call commands

### Cross-Platform Support

- [x] **XP-01**: Test stdio process spawning on Windows and ensure no zombie processes remain
- [x] **XP-02**: Implement Windows named pipe security flags (security_qos_flags) to prevent privilege escalation
- [x] **XP-03**: Ensure MCP protocol compliance for stdio transport (newline-delimited messages, no embedded newlines)
- [x] **XP-04**: Validate connection daemon functionality on Linux, macOS, and Windows

---

## Milestone Summary

**Shipped:** 18/18 v1.2 requirements
**Adjusted:** None - all requirements implemented as specified
**Dropped:** None - no requirements removed during implementation

**v1 Requirements:** All 42 v1 requirements remain satisfied and carried forward to next milestone

---

*Archived: 2026-02-12 as part of v1.2 milestone completion*
