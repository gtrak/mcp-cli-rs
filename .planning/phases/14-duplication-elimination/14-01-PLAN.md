---
phase: 14-duplication-elimination
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/transport.rs
  - src/client/transport.rs
  - src/client/mod.rs
  - src/daemon/pool.rs
  - src/lib.rs
autonomous: true

must_haves:
  truths:
    - "Single transport trait definition exists in src/transport.rs"
    - "src/client/transport.rs is deleted or re-exports from src/transport.rs"
    - "All code using client::transport::Transport now uses crate::transport::Transport"
  artifacts:
    - path: "src/transport.rs"
      provides: "Single Transport trait with send, send_notification, receive_notification, ping, transport_type"
    - path: "src/client/mod.rs"
      provides: "Uses crate::transport::Transport instead of local transport module"
  key_links:
    - from: "src/client/mod.rs"
      to: "src/transport.rs"
      via: "use crate::transport::{Transport, TransportFactory}"
      pattern: "use crate::transport"
    - from: "src/daemon/pool.rs"
      to: "src/transport.rs"
      via: "use crate::transport"
      pattern: "use crate::transport"
---

<objective>
Consolidate duplicate transport traits into single source of truth.

Purpose: DUP-05 requires merging src/transport.rs (82 lines) and src/client/transport.rs (69 lines). The two files define nearly identical Transport traits - src/transport.rs has the full version (send, send_notification, receive_notification, ping, transport_type) while src/client/transport.rs has a subset (send, ping, transport_type). Consolidating removes the duplicate and ensures one trait definition.

Output: Single Transport trait in src/transport.rs, client/transport.rs eliminated, all imports updated.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/transport.rs
@src/client/transport.rs
@src/client/mod.rs
@src/daemon/pool.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove client/transport.rs and update client/mod.rs imports</name>
  <files>src/client/transport.rs, src/client/mod.rs</files>
  <action>
1. Delete src/client/transport.rs entirely - its Transport trait is a strict subset of src/transport.rs
2. In src/client/mod.rs, the import `use crate::transport::{Transport, TransportFactory};` already exists on line 11, so it already uses the correct transport module
3. Verify no other files import from `crate::client::transport` - search for `client::transport` across the codebase
4. If client/mod.rs has `pub mod transport;` declaration, remove it
5. Check src/lib.rs to ensure there's no re-export of client::transport that needs updating
  </action>
  <verify>
`cargo check` passes with no errors.
`cargo clippy --lib` produces zero warnings.
Search for `client::transport` across src/ returns no results.
  </verify>
  <done>
src/client/transport.rs is deleted. All code uses crate::transport::Transport. Compilation succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify transport consolidation with tests</name>
  <files>src/transport.rs</files>
  <action>
1. Run the full test suite to confirm no regressions from transport consolidation
2. Verify that src/transport.rs contains the complete Transport trait with all 5 methods: send, send_notification, receive_notification, ping, transport_type
3. Verify TransportFactory trait and BoxedTransport type alias are in src/transport.rs
4. Check that daemon/pool.rs DummyTransport still implements the correct Transport trait (it should already use crate::transport::Transport)
5. If any tests fail, fix the imports - the issue will be stale references to the deleted module
  </action>
  <verify>
`cargo test` passes (all tests).
`cargo check` clean.
  </verify>
  <done>
Transport trait exists in exactly one location (src/transport.rs). All tests pass. No duplicate transport definitions exist.
  </done>
</task>

</tasks>

<verification>
- `rg "client::transport" src/` returns no results
- `cargo check` passes
- `cargo clippy --lib` passes with zero warnings  
- `cargo test` passes
- src/client/transport.rs does not exist
</verification>

<success_criteria>
DUP-05 satisfied: Single transport abstraction exists in src/transport.rs. No duplicate Transport trait definitions. All tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/14-duplication-elimination/14-01-SUMMARY.md`
</output>
