---
phase: 21-ux-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/entry.rs
  - src/cli/command_router.rs
  - src/error.rs
autonomous: true

must_haves:
  truths:
    - "User can run mcp --version and see version output"
    - "User sees helpful examples in --help output"
    - "User sees environment variables documented in help"
    - "User does not see developer warning text in help"
    - "Unknown subcommands show 'Did you mean?' suggestions"
    - "Server not found errors show available servers"
    - "Invalid JSON errors show helpful format hints"
  artifacts:
    - path: src/cli/entry.rs
      provides: CLI struct with version, examples, env docs, cleaned help text
    - path: src/cli/command_router.rs
      provides: Command enum with examples, grep alias support
    - path: src/error.rs
      provides: Enhanced error messages with suggestions
  key_links:
    - from: src/cli/entry.rs
      to: Cargo.toml
      via: version macro
      pattern: "clap.*version"
---

<objective>
Fix identified UX issues from Phase 20 audit (10 fixes: FIX-01 through FIX-10)

Purpose: Improve CLI usability by adding --version, examples to help, removing warning text, documenting env vars, and improving error messages with suggestions

Output: Enhanced CLI with better help text, version flag, and user-friendly error messages
</objective>

<context>
@./.planning/phases/20-ux-audit/20-01-UX-AUDIT.md

# Phase 20 Audit Findings - 10 UX fixes needed:

**Priority 1 (P1) - Help text improvements:**
- FIX-01: Add --version flag
- FIX-02: Add examples to help text
- FIX-03: Remove warning text from help (currently shows "has known issues")
- FIX-04: Add environment variable docs to help

**Priority 2 (P2) - Error handling improvements:**
- FIX-05: Add "Did you mean?" suggestions for unknown subcommands
- FIX-06: Show available servers in server-not-found errors
- FIX-07: Improve JSON argument error messages with format hints

**Priority 3 (P3) - Nice to have:**
- FIX-08: Add grep as alias for search
- FIX-09: Support stdin for tool args
- FIX-10: Add format explanation to help (server/tool vs server tool)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Help text improvements (FIX-01, FIX-02, FIX-03, FIX-04, FIX-10)</name>
  <files>src/cli/entry.rs, src/cli/command_router.rs</files>
  <action>
1. **Add --version flag (FIX-01):**
   - In src/cli/entry.rs, add `#[command(version)]` attribute to Cli struct
   - Ensure Cargo.toml has version field (check existing)
   - Verify `mcp --version` outputs version string

2. **Remove warning text from help (FIX-03):**
   - In entry.rs lines 30-31, remove "**currently recommended for daemon-mode issues**"
   - In entry.rs line 34, remove "**has known issues on Windows**"
   - Keep help text clean and user-focused

3. **Add examples to help (FIX-02):**
   - Add `#[command(long_about)]` to Cli struct with examples section
   - Add examples to each command in Commands enum (command_router.rs)
   - Example: "mcp list -d", "mcp info filesystem", "mcp call server tool '{}'"

4. **Add environment variable docs (FIX-04):**
   - Add ENV VARS section to main help: MCP_DAEMON_TTL, MCP_NO_DAEMON

5. **Add format explanation (FIX-10):**
   - Document "server/tool" and "server tool" formats in help
  </action>
  <verify>
- `cargo run -- --version` shows version
- `cargo run -- --help` shows examples and env vars, no warnings
- `cargo run list --help` shows command examples
  </verify>
  <done>
- --version flag works and shows version
- --help shows examples for each command
- --help shows environment variables section
- No developer warning text in help output
- Help documents both format styles
  </done>
</task>

<task type="auto">
  <name>Task 2: Error message improvements (FIX-05, FIX-06, FIX-07)</name>
  <files>src/error.rs, src/cli/command_router.rs</files>
  <action>
1. **Add "Did you mean?" suggestions (FIX-05):**
   - Handle unknown subcommand errors in command_router.rs or entry.rs
   - Check for similar command names (e.g., "run" â†’ "call", "list" vs "list")
   - Output: "Unknown command 'run'. Did you mean 'call'?"

2. **Show available servers in errors (FIX-06):**
   - In src/error.rs, enhance ServerNotFound variant to include available servers
   - Modify error construction to pass configured server list
   - Output: "Server 'xyz' not found. Available servers: a, b, c"

3. **Improve JSON argument errors (FIX-07):**
   - In InvalidJson error, add suggestion about valid JSON format
   - Output: "Invalid JSON: ... Expected format: {\"key\": \"value\"}"
  </verify>
  <done>
- Unknown command shows "Did you mean?" with suggestion
- Server not found shows list of available servers
- JSON parse errors show expected format hint
  </done>
</task>

<task type="auto">
  <name>Task 3: Optional enhancements (FIX-08, FIX-09)</name>
  <files>src/cli/command_router.rs, src/cli/call.rs</files>
  <action>
1. **Add grep alias for search (FIX-08):**
   - In command_router.rs, add `#[command(alias("grep"))]` to Search variant
   - Both "mcp search" and "mcp grep" work

2. **Support stdin for tool args (FIX-09):**
   - In call.rs, check if args is None and stdin has content
   - Read from stdin if no args provided and stdin is not tty
   - Support: `echo '{"key": "value"}' | mcp call server tool`
  </verify>
  <done>
- "mcp grep" works as alias for "mcp search"
- Tool call accepts args from stdin when not provided as argument
  </done>
</task>

</tasks>

<verification>
Run the following to verify all fixes:

```bash
# Test --version
cargo run -- --version

# Test help shows examples
cargo run -- --help
cargo run -- list --help

# Test unknown command shows suggestion
cargo run -- run 2>&1 || true

# Test grep alias
cargo run -- grep "*test*" 2>&1 || true

# Verify no warnings in help
cargo run -- --help 2>&1 | grep -i "issues" || echo "No warnings found"

# Run tests
cargo test
```
</verification>

<success_criteria>
All 10 UX fixes from Phase 20 audit implemented:
- [x] FIX-01: --version flag works
- [x] FIX-02: Help shows examples  
- [x] FIX-03: No warning text in help
- [x] FIX-04: Env vars documented
- [x] FIX-05: "Did you mean?" suggestions
- [x] FIX-06: Available servers in errors
- [x] FIX-07: JSON format hints
- [x] FIX-08: grep alias works
- [x] FIX-09: stdin support for args
- [x] FIX-10: Format explanation in help
</success_criteria>

<output>
After completion, create `.planning/phases/21-ux-improvements/21-01-SUMMARY.md`
</output>
