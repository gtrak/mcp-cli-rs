---
phase: 06-output-formatting
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/cli/commands.rs
  - src/cli/mod.rs
autonomous: true
must_haves:
  truths:
    - "Tool list command shows parameter overview in help-style format"
    - "Default view shows tool count and brief descriptions per server"
    - "Multi-server output has clear visual hierarchy with headers"
    - "Server status is visually indicated (connected, failed, filtered)"
  artifacts:
    - path: "src/cli/commands.rs"
      provides: "Updated list command with formatting"
      contains: "cmd_list_servers", "DetailLevel"
    - path: "src/cli/mod.rs"
      provides: "DetailLevel enum export"
      exports: ["DetailLevel"]
  key_links:
    - from: "src/cli/commands.rs"
      to: "src/format/params.rs"
      via: "format_param_list import"
      pattern: "use crate::format"
    - from: "cmd_list_servers"
      to: "DetailLevel"
      via: "function parameter"
      pattern: "detail_level: DetailLevel"
---

<objective>
Update the list command with help-style parameter display, visual hierarchy, and server status indicators.

Purpose: Transform the basic list output into a visually organized, information-rich display that helps users understand available tools at a glance.
Output: Enhanced cmd_list_servers with help-style formatting, server headers, and status indicators.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-output-formatting/06-01-SUMMARY.md
@src/cli/commands.rs
@src/format/mod.rs

**Requirements to implement:**
- OUTP-01: Parameter overview in help-style format
- OUTP-03: Default list shows tool count and brief descriptions per server
- OUTP-04: Multi-server listings with visual hierarchy (headers, grouping)
- OUTP-11: Tool descriptions prominently displayed (not truncated)
- OUTP-12: Usage hints in tool listings
- OUTP-13: Server status clearly indicated
- OUTP-15: Helpful empty state messages
- OUTP-18: Partial failure reporting

**Existing cmd_list_servers behavior:**
- Lists servers with description and transport type
- Shows tool count
- Optionally shows tool names with -d flag
- Warns about partial failures

**Current limitations:**
- No parameter information displayed
- No visual hierarchy between servers
- Descriptions only shown with -d flag (not prominent)
- No usage hints
- Server status not clearly indicated
</context>

<tasks>

<task type="auto">
  <name>Add DetailLevel enum and update command signature</name>
  <files>src/cli/mod.rs, src/cli/commands.rs</files>
  <action>
1. Add `DetailLevel` enum to `src/cli/mod.rs`:
   ```rust
   /// Level of detail for tool listings
   #[derive(Debug, Clone, Copy, PartialEq, Eq)]
   pub enum DetailLevel {
       /// Summary view: tool names and brief descriptions
       Summary,
       /// With descriptions: adds parameter overview
       WithDescriptions,
       /// Verbose: full schema details
       Verbose,
   }
   
   impl Default for DetailLevel {
       fn default() -> Self { DetailLevel::Summary }
   }
   ```
   
   Export it: `pub use commands::{..., DetailLevel};`

2. Update `cmd_list_servers` signature in `src/cli/commands.rs`:
   ```rust
   pub async fn cmd_list_servers(
       mut daemon: Box<dyn ProtocolClient>, 
       detail_level: DetailLevel
   ) -> Result<()>
   ```
   
   Remove the `with_descriptions: bool` parameter and replace with `detail_level`.

3. Update all imports:
   - Add: `use crate::format::{extract_params_from_schema, format_param_list, ParameterInfo};`
   - Add: `use crate::cli::DetailLevel;`
   - Remove old `with_descriptions` logic

4. Find all callers of `cmd_list_servers` and update them:
   - Search for all usages in the codebase
   - Update main.rs or wherever the command is called
   - Map CLI flags to DetailLevel:
     - No flags → DetailLevel::Summary
     - -d/--describe → DetailLevel::WithDescriptions
     - -v/--verbose → DetailLevel::Verbose

Ensure backward compatibility: The default behavior should still work (show servers and tool counts).
  </action>
  <verify>
cargo check 2>&1 | grep -E "(error|warning)" | head -20
  </verify>
  <done>
DetailLevel enum defined and exported, cmd_list_servers signature updated, all callers compile without errors.
  </done>
</task>

<task type="auto">
  <name>Implement enhanced server display with visual hierarchy</name>
  <files>src/cli/commands.rs</files>
  <action>
Rewrite the server display section in `cmd_list_servers` to add visual hierarchy:

1. Before the main loop, print a header:
   ```rust
   println!("{} {}", "MCP Servers".bold(), format!("({})", successes.len()).dimmed());
   println!("{}", "─".repeat(50).dimmed());
   ```

2. For each server in successes, create a structured display:
   ```
   server_name  (transport_type)
   ════════════════════════════════
   Description: [server description or "No description"]
   Tools: [count]
   
   [tool list with formatting based on detail_level]
   
   [usage hint if Summary level]
   ```

3. Implement server header formatting:
   - Server name in bold
   - Transport type in parentheses, dimmed
   - Separator line using box-drawing characters or simple dashes
   - Status indicator prefix:
     - "✓" (green) for connected successfully
     - "⚠" (yellow) if has disabled tools

4. Implement tool list formatting based on detail_level:
   
   **Summary level (default):**
   ```
   • tool_name: Brief description here...
     Usage: tool_name <param1> [param2]
   ```
   - Show tool name with bullet point
   - Show truncated description (max 60 chars)
   - Show parameter overview using format_param_list from format module
   - Add usage hint: "Use 'mcp info server tool' for full schema"
   
   **WithDescriptions level (-d):**
   ```
   tool_name
     Description: Full description text...
     Parameters:
       param1 <string>  Required. Description...
       param2 [number]  Optional. Description...
   ```
   - Multi-line format
   - Full descriptions
   - Detailed parameter info
   
   **Verbose level (-v):**
   - Include all of WithDescriptions
   - Add full JSON Schema
   - Show default values, enums, examples

5. Add empty state handling (OUTP-15):
   - If no servers configured: helpful message with config file example
   - If no tools on server: "No tools available on this server"
   - If filtered out all tools: "All tools filtered by configuration"

6. Update partial failure display (OUTP-18):
   ```
   ⚠ Connection Issues (N servers)
   ─────────────────────────────
   ✗ server1: Connection refused
   ✗ server2: Timeout after 30s
   ```
   - Group failures under clear header
   - Show specific error per server
   - Use visual indicators (✗ for failed)

Use the format module functions created in Plan 06-01. Use colored crate for styling. Keep output width reasonable (max 80-100 chars).
  </action>
  <verify>
cargo test cmd_list_servers 2>&1 | tail -20
cargo build 2>&1 | grep -E "(error|warning)" | head -10
  </verify>
  <done>
cmd_list_servers displays servers with visual hierarchy, shows tool parameters in help-style format, displays server status indicators, and handles empty states gracefully. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. DetailLevel enum works across all detail levels
2. Server display has clear visual hierarchy with headers and separators
3. Tool listings show parameter overview in help-style format
4. Server status is visually indicated
5. Empty states have helpful messages
6. Partial failures are clearly reported
7. Code compiles and tests pass
</verification>

<success_criteria>
- DetailLevel enum exported from cli module
- cmd_list_servers accepts DetailLevel parameter
- Default view shows servers with tool counts and brief descriptions
- Help-style parameter display using <required> [optional] convention
- Visual hierarchy with server headers and separators
- Server status indicators (connected, filtered, failed)
- Empty state messages are helpful and actionable
- Partial failure reporting is clear and informative
</success_criteria>

<output>
After completion, create `.planning/phases/06-output-formatting/06-02-SUMMARY.md`
</output>
