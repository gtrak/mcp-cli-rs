---
phase: 27
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
autonomous: true

must_haves:
  truths:
    - "CI workflow exists and is syntactically valid"
    - "Workflow triggers on PR and push to main"
    - "Workflow tests on Linux, Windows, and macOS"
    - "Rust toolchain is properly configured"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI workflow"
      must_contain:
        - "on: [push, pull_request]"
        - "os: [ubuntu-latest, windows-latest, macos-latest]"
        - "dtolnay/rust-cache"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "cargo test"
      via: "runs cargo test commands in workflow steps"
---

<objective>
Create GitHub Actions CI workflow with matrix builds for Linux, Windows, and macOS testing

Purpose: Automate cross-platform testing on every PR and push to main, ensuring code quality across all supported platforms
Output: .github/workflows/ci.yml with matrix builds for all three platforms
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/27-ci-cd-setup/27-CONTEXT.md
@/home/gary/dev/mcp-cli-rs/Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Create .github/workflows directory</name>
  <files>.github/workflows/</files>
  <action>
    Create the .github/workflows/ directory if it doesn't exist.
    This directory is required for GitHub Actions to discover workflow files.
    
    Command: mkdir -p .github/workflows
  </action>
  <verify>ls -la .github/workflows/</verify>
  <done>Directory exists and is empty or contains only other workflow files</done>
</task>

<task type="auto">
  <name>Create CI workflow with matrix builds</name>
  <files>.github/workflows/ci.yml</files>
  <action>
    Create .github/workflows/ci.yml with the following content:
    
    - Workflow name: "CI"
    - Triggers: on push to main and on pull_request to main
    - Jobs:
      - Job name: "test"
      - Matrix strategy with os: [ubuntu-latest, windows-latest, macos-latest]
      - Steps:
        1. Checkout code (actions/checkout@v4)
        2. Install Rust toolchain (dtolnay/rust-toolchain@stable)
        3. Cache dependencies (dtolnay/rust-cache@v2)
        4. Run cargo build
        5. Run cargo test --lib (library tests)
        6. Run cargo test --test '*' (integration tests)
        7. Run cargo clippy -- -D warnings (linting, fail on warnings)
        8. Run cargo fmt --check (formatting check)
    
    The workflow should:
    - Use fail-fast: false (allow all platforms to run even if one fails)
    - Set appropriate timeout (e.g., 15 minutes)
    - Run on the stable Rust toolchain
    - Include proper shell configuration for Windows (bash or pwsh)
    
    Reference the workflow from Phase 25-02-SUMMARY.md where tests were validated:
    - Library tests: 109 tests pass
    - Integration tests: 71+ tests pass
  </action>
  <verify>
    Validate YAML syntax:
    - cat .github/workflows/ci.yml | head -50
    - Use yamllint or similar if available
    - At minimum, verify file structure looks correct
  </verify>
  <done>
    - Workflow file exists at .github/workflows/ci.yml
    - File contains matrix builds for all 3 platforms
    - File includes build, test, clippy, and fmt steps
    - YAML syntax is valid (no obvious errors)
  </done>
</task>

</tasks>

<verification>
- Workflow file exists at .github/workflows/ci.yml
- File is valid YAML syntax
- Contains matrix strategy for ubuntu-latest, windows-latest, macos-latest
- Triggers on push to main and pull_request to main
- Includes cargo build, cargo test, cargo clippy, and cargo fmt steps
- Uses dtolnay/rust-cache for dependency caching
</verification>

<success_criteria>
- [ ] .github/workflows/ci.yml exists
- [ ] Workflow triggers on PR and push to main (CI-04)
- [ ] Workflow includes Linux testing (CI-01)
- [ ] Workflow includes Windows testing (CI-02)
- [ ] Workflow includes macOS testing (CI-03)
- [ ] YAML is syntactically valid
- [ ] Uses proper actions (actions/checkout@v4, dtolnay/rust-toolchain@stable, dtolnay/rust-cache@v2)
</success_criteria>

<output>
After completion, create `.planning/phases/27-ci-cd-setup/27-01-SUMMARY.md`
</output>
