---
phase: 25-cross-platform-test-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/orphan_cleanup_tests.rs
  - tests/cross_platform_daemon_tests.rs
autonomous: true

must_haves:
  truths:
    - "orphan_cleanup_tests.rs compiles without errors"
    - "cross_platform_daemon_tests.rs compiles without errors"
    - "Integration test suite can be built successfully"
  artifacts:
    - path: "tests/orphan_cleanup_tests.rs"
      provides: "Orphan cleanup integration tests"
      status: "compiles"
    - path: "tests/cross_platform_daemon_tests.rs"
      provides: "Cross-platform daemon tests"
      status: "compiles"
  key_links:
    - from: "tests/orphan_cleanup_tests.rs"
      to: "mcp_cli_rs::daemon::orphan::kill_daemon_process"
      via: "direct function call"
    - from: "tests/cross_platform_daemon_tests.rs"
      to: "mcp_cli_rs::ipc::unix::UnixIpcServer::new"
      via: "async/await pattern"
---

<objective>
Fix compilation errors in integration test files to enable full test suite execution.

**Purpose:** Phase 24 fixed library compilation on Linux, but integration tests still have compilation errors blocking test validation. This plan fixes those specific errors.

**Output:** Two integration test files that compile successfully.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

## Current State

**Phase 24 Complete:**
- ✅ 109 library tests pass on Linux
- ✅ All Linux compilation errors in library resolved
- ❌ Integration tests have compilation errors

**Errors to Fix:**
1. `orphan_cleanup_tests.rs:236`: `super::kill_daemon_process` - function not in parent scope
2. `cross_platform_daemon_tests.rs:34-35`: Missing `.await` on async `UnixIpcServer::new()` call

## Code Context

From `src/daemon/orphan.rs`:
- `kill_daemon_process(pid: u32)` is a public function in the orphan module
- Must be imported via `mcp_cli_rs::daemon::orphan::kill_daemon_process`

From `src/ipc/unix.rs`:
- `UnixIpcServer::new()` is async and returns `impl Future<Output = Result<...>>`
- Must use `.await` before `.expect()`
</context>

<tasks>

<task type="auto">
  <name>Fix orphan_cleanup_tests.rs import error</name>
  <files>tests/orphan_cleanup_tests.rs</files>
  <action>
Fix the `super::kill_daemon_process` call at line 236 in the test `test_kill_daemon_process_unix`.

Current code:
```rust
let result = super::kill_daemon_process(pid);
```

Change to:
```rust
use mcp_cli_rs::daemon::orphan::kill_daemon_process;
// Then use:
let result = kill_daemon_process(pid);
```

Or add the import at the top of the file with other imports and call directly.

Verify by running: `cargo test --test orphan_cleanup_tests --no-run` (compile only, don't run)
  </action>
  <verify>cargo test --test orphan_cleanup_tests --no-run 2>&1 | grep -c "error\[" | grep "^0$"</verify>
  <done>orphan_cleanup_tests.rs compiles without errors</done>
</task>

<task type="auto">
  <name>Fix cross_platform_daemon_tests.rs async error</name>
  <files>tests/cross_platform_daemon_tests.rs</files>
  <action>
Fix the missing `.await` in the `test_ipc_server_trait_consistency` test at lines 34-35.

Current code:
```rust
let server = mcp_cli_rs::ipc::UnixIpcServer::new(&socket_path)
    .expect("Failed to create UnixIpcServer");
```

Change to:
```rust
let server = mcp_cli_rs::ipc::UnixIpcServer::new(&socket_path)
    .await
    .expect("Failed to create UnixIpcServer");
```

The `new` method is async and returns a Future, so it must be awaited before unwrapping with `.expect()`.

Verify by running: `cargo test --test cross_platform_daemon_tests --no-run` (compile only, don't run)
  </action>
  <verify>cargo test --test cross_platform_daemon_tests --no-run 2>&1 | grep -c "error\[" | grep "^0$"</verify>
  <done>cross_platform_daemon_tests.rs compiles without errors</done>
</task>

</tasks>

<verification>
- Both test files compile without errors
- `cargo test --test orphan_cleanup_tests --no-run` succeeds
- `cargo test --test cross_platform_daemon_tests --no-run` succeeds
</verification>

<success_criteria>
1. `cargo test --test orphan_cleanup_tests --no-run` returns success
2. `cargo test --test cross_platform_daemon_tests --no-run` returns success
3. No compilation errors in either test file
</success_criteria>

<output>
After completion, create `.planning/phases/25-cross-platform-test-validation/25-01-SUMMARY.md`
</output>
