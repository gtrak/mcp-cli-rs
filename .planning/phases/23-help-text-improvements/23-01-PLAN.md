---
phase: 23-help-text-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/call.rs
  - src/cli/command_router.rs
  - src/cli/list.rs
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees valid JSON format hint in argument error messages"
    - "User sees both JSON and --args flag formats documented in call command help"
    - "User sees flag usage example in call command help"
    - "User sees calling hint when listing tools"
  artifacts:
    - path: "src/cli/call.rs"
      provides: "Error message with JSON format hint"
      contains: "parse error"
    - path: "src/cli/command_router.rs"
      provides: "Call command help documentation"
      contains: "--key value"
    - path: "src/cli/list.rs"
      provides: "Calling hint in tool listing"
      contains: "call"
---

<objective>
Implement Phase 23: Help Text Improvements

Purpose: Fix JSON error message to show valid format and document both JSON and `--args` flag usage in help text.

Output: Updated CLI with improved error messages and help documentation.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

# Phase context (from 23-CONTEXT.md)

**Decisions (locked):**
- Error message is specific about what went wrong (parse error, schema mismatch, etc.)
- Includes hint pointing to tool-specific help: `Run 'mcp-cli call <tool-name> --help' for valid parameters`
- If tool name is known at error time, hint includes the specific tool name
- Main help (`--help`) documents both JSON format and `--args` flag format
- Tool-specific help via `mcp-cli call <tool-name> --help` adapts to that tool's schema
- Tool-specific help displays: parameter names, types, required vs optional, descriptions from schema
- No usage examples needed in help

# Prior work (from Phase 22)

Phase 22 implemented dynamic flag parsing with `parse_arguments` function in `src/cli/call.rs`. This phase builds on that by improving error messages and help text.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix error message to show valid JSON format (HELP-01)</name>
  <files>src/cli/call.rs</files>
  <action>
Update the error message in parse_arguments function to show valid JSON format hint.

Current error (line 40-43):
```rust
return Err(McpError::usage_error(&format!(
    "Expected --key value pair, got: {}",
    arg
)));
```

Change to:
```rust
return Err(McpError::usage_error(&format!(
    "Invalid argument: {}. Use JSON format: {{\"key\": \"value\"}} or flags: --key value",
    arg
)));
```

Note: The InvalidJson error already has a format hint: "Expected format: {'\"key\"': \"value\"}". No changes needed there.
  </action>
  <verify>grep -n "Invalid argument" src/cli/call.rs</verify>
  <done>Error messages show valid JSON format hint: {"key": "value"}</done>
</task>

<task type="auto">
  <name>Task 2: Document both formats in call help (HELP-02)</name>
  <files>src/cli/command_router.rs</files>
  <action>
Update the Call command docstring (lines 90-98) to better document both JSON and --key value formats.

Current docstring:
```rust
/// Execute a tool (EXEC-01, EXEC-02)
///
/// Examples:
///   mcp call filesystem/read_file '{}'                              # JSON args
///   mcp call filesystem/read_file '{"path": "/tmp"}'               # JSON args
///   mcp call filesystem/read_file --path /tmp/file.txt             # --key value style
///   mcp call filesystem/read_file --path=/tmp/file.txt             # --key=value style
///   mcp call filesystem/read_file --options '{"a":1}'              # JSON value
///   echo '{"path": "/tmp"}' | mcp call filesystem/read_file        # From stdin
```

Keep the examples as-is (they already show both formats), but add a clearer description.
</action>
  <verify>grep -n "Execute a tool" src/cli/command_router.rs</verify>
  <done>Call command help documents both JSON and --key value formats</done>
</task>

<task type="auto">
  <name>Task 3: Add flag usage example to call help (HELP-03)</name>
  <files>src/cli/command_router.rs</files>
  <action>
The existing examples in the Call command docstring already show --key value style. Verify the examples are clear enough, or add a more explicit example.

Current examples already include:
- `mcp call filesystem/read_file --path /tmp/file.txt`
- `mcp call filesystem/read_file --path=/tmp/file.txt`
- `mcp call filesystem/read_file --options '{"a":1}'`

These are sufficient. The task is complete if HELP-02 examples are present.
</action>
  <verify>grep -n "--path" src/cli/command_router.rs</verify>
  <done>Call command help shows flag usage example</done>
</task>

<task type="auto">
  <name>Task 4: Update list command to show calling hint (HELP-04)</name>
  <files>src/cli/list.rs</files>
  <action>
Update the list command output to show a hint about how to call each tool. Add a "Usage" or "Call" hint column or footnote.

Look for where tool information is displayed in cmd_list_servers or the formatter. Add a hint like:
- "Run: mcp call <server>/<tool> --help" 
- Or in verbose mode: "Call: mcp call <server>/<tool> --arg value"

Check how tools are displayed in DetailLevel::WithDescriptions or DetailLevel::Verbose modes.
</action>
<parameter name="verify">grep -n "call" src/cli/list.rs | head -20